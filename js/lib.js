var Lightbox=null;
(function(c){Lightbox={activeImage:null,badObjects:["select","object","embed"],container:null,enableSlideshow:null,groupName:null,imageArray:[],options:null,overlayDuration:null,overlayOpacity:null,playSlides:null,refTags:["a","area"],relAttribute:null,resizeDuration:null,slideShowTimer:null,startImage:null,initialize:function(a){this.options=c.extend(true,{animate:true,autoPlay:true,borderSize:10,containerID:document,enableSlideshow:true,googleAnalytics:false,imageDataLocation:"south",initImage:"",
loop:true,overlayDuration:0.2,overlayOpacity:0.8,prefix:"",relAttribute:"lightbox",resizeSpeed:400,showGroupName:false,slideTime:4,strings:{closeLink:"close",loadingMsg:"loading",nextLink:"next &raquo;",prevLink:"&laquo; prev",startSlideshow:"start slideshow",stopSlideshow:"stop slideshow",numDisplayPrefix:"Image",numDisplaySeparator:"of"}},a);if(this.options.animate){this.overlayDuration=Math.max(this.options.overlayDuration,0);this.resizeDuration=this.options.resizeSpeed}else this.resizeDuration=
this.overlayDuration=0;this.enableSlideshow=this.options.enableSlideshow;this.overlayOpacity=Math.max(Math.min(this.options.overlayOpacity,1),0);this.playSlides=this.options.autoPlay;this.container=c(this.options.containerID);this.relAttribute=this.options.relAttribute;this.updateImageList();var b=this;a=c(this.container).get(0)!=document?this.container:c("body");c("<div/>",{id:this.getID("overlay"),css:{display:"none"}}).appendTo(a).click(function(){b.end()});a=c("<div/>",{id:this.getID("lightbox"),
css:{display:"none"}}).appendTo(a).click(function(){b.end()});var d=c("<div/>",{id:this.getID("imageDataContainer"),"class":this.getID("clearfix")}).click(function(g){g.stopPropagation()}),e=c("<div/>",{id:this.getID("imageData")}).appendTo(d),f=c("<div/>",{id:this.getID("imageDetails")}).appendTo(e);c("<span/>",{id:this.getID("caption")}).appendTo(f);c("<span/>",{id:this.getID("numberDisplay")}).appendTo(f);f=c("<span/>",{id:this.getID("detailsNav")}).appendTo(f);c("<a/>",{id:this.getID("prevLinkDetails"),
href:"javascript:void(0);",html:this.options.strings.prevLink}).appendTo(f).click(function(){b.showPrev()});c("<a/>",{id:this.getID("nextLinkDetails"),href:"javascript:void(0);",html:this.options.strings.nextLink}).appendTo(f).click(function(){b.showNext()});c("<a/>",{id:this.getID("slideShowControl"),href:"javascript:void(0);"}).appendTo(f).click(function(){b.toggleSlideShow()});e=c("<div/>",{id:this.getID("close")}).appendTo(e);c("<a/>",{id:this.getID("closeLink"),href:"javascript:void(0);",html:this.options.strings.closeLink}).appendTo(e).click(function(){b.end()});
this.options.imageDataLocation=="north"&&c(a).append(d);e=c("<div/>",{id:this.getID("outerImageContainer")}).appendTo(a).click(function(g){g.stopPropagation()});e=c("<div/>",{id:this.getID("imageContainer")}).appendTo(e);c("<img/>",{id:this.getID("lightboxImage")}).appendTo(e);f=c("<div/>",{id:this.getID("hoverNav")}).appendTo(e);c("<a/>",{id:this.getID("prevLinkImg"),href:"javascript:void(0);"}).appendTo(f).click(function(){b.showPrev()});c("<a/>",{id:this.getID("nextLinkImg"),href:"javascript:void(0);"}).appendTo(f).click(function(){b.showNext()});
e=c("<div/>",{id:this.getID("loading")}).appendTo(e);c("<a/>",{id:this.getID("loadingLink"),href:"javascript:void(0);",html:this.options.strings.loadingMsg}).appendTo(e).click(function(){b.end()});this.options.imageDataLocation!="north"&&c(a).append(d);this.options.initImage!=""&&this.start(c(this.options.initImage))},updateImageList:function(){for(var a,b,d,e=this,f=0;f<this.refTags.length;f++){b=c(this.container).find(this.refTags[f]);for(var g=0;g<b.length;g++){a=b[g];d=c(a).attr("rel");c(a).attr("href")&&
d.toLowerCase().match(this.relAttribute)&&c(a).click(function(){e.start(this);return false})}}},getCaption:function(a){a=c(a);var b=a.attr("title")||"";if(b==""){var d=c(a).find("img").first();if(c(d).length)b=c(d).attr("title")||c(d).attr("alt");b||(b=a.text()||a.attr("href")||"")}return b},start:function(a){a=c(a);this.hideBadObjects();var b=this.getPageSize();this.getEl("overlay").height(b.pageHeight).fadeTo(this.overlayDuration,this.overlayOpacity);this.imageArray=[];this.groupName=null;var d=
c(a).attr("rel"),e="";if(d==this.relAttribute){e=this.getCaption(a);this.imageArray.push({link:c(a).attr("href"),title:e});this.startImage=0}else{for(var f=c(this.container).find(c(a).get(0).tagName.toLowerCase()),g=0;g<f.length;g++){var h=c(f[g]);if(h.attr("href")&&h.attr("rel")==d){e=this.getCaption(h);this.imageArray.push({link:h.attr("href"),title:e});if(c(h).get(0)==c(a).get(0))this.startImage=this.imageArray.length-1}}this.groupName=d.substring(this.relAttribute.length+1,d.length-1)}a=this.getPageScroll().y+
b.winHeight/15;this.getEl("lightbox").css("top",a+"px").show();this.changeImage(this.startImage)},changeImage:function(a){this.activeImage=a;this.disableKeyboardNav();this.pauseSlideShow();this.getEl("loading").show();this.getEl("lightboxImage").hide();this.getEl("hoverNav").hide();this.getEl("imageDataContainer").hide();this.getEl("numberDisplay").hide();this.getEl("detailsNav").hide();var b=new Image,d=this;c(b).bind("load",function(){d.getEl("lightboxImage").attr("src",b.src);d.resizeImageContainer(b.width,
b.height);d.isSlideShowActive()&&d.startSlideshow()});b.src=this.imageArray[this.activeImage].link;this.options.googleAnalytics&&urchinTracker(this.imageArray[this.activeImage].link)},resizeImageContainer:function(a,b){this.getEl("outerImageContainer");var d=this.options.borderSize*2;this.getEl("outerImageContainer").animate({width:a+d,height:b+d},this.resizeDuration);this.getEl("prevLinkImg").height(b);this.getEl("nextLinkImg").height(b);this.getEl("imageDataContainer").width(a+d);this.showImage()},
showImage:function(){this.getEl("loading").hide();var a=this;this.getEl("lightboxImage").fadeIn(500,function(){a.updateDetails()});this.preloadNeighborImages()},updateDetails:function(){this.getEl("caption").text(this.imageArray[this.activeImage].title);this.getEl("caption").show();if(this.hasImages()){var a=this.options.strings.numDisplayPrefix+" "+eval(this.activeImage+1)+" "+this.options.strings.numDisplaySeparator+" "+this.imageArray.length;if(this.options.showGroupName&&this.groupName!="")a+=
" "+this.options.strings.numDisplaySeparator+" "+this.groupName;this.getEl("numberDisplay").text(a).show();this.enableSlideshow||this.getEl("slideShowControl").hide();this.getEl("detailsNav").show()}var b=this;this.getEl("imageDataContainer").animate({height:"toggle",opacity:"toggle"},650,function(){b.updateNav()})},updateNav:function(){if(this.hasImages()){this.getEl("hoverNav").show();if(this.enableSlideshow)this.playSlides?this.startSlideShow():this.stopSlideShow()}this.enableKeyboardNav()},isSlideShowActive:function(){return this.playSlides},
startSlideShow:function(){this.playSlides=true;var a=this;this.slideShowTimer=setInterval(function(){a.showNext();a.pauseSlideShow()},this.options.slideTime*1E3);this.getEl("slideShowControl").text(this.options.strings.stopSlideshow)},stopSlideShow:function(){this.playSlides=false;this.slideShowTimer&&clearInterval(this.slideShowTimer);this.getEl("slideShowControl").text(this.options.strings.startSlideshow)},toggleSlideShow:function(){this.playSlides?this.stopSlideShow():this.startSlideShow()},pauseSlideShow:function(){this.slideShowTimer&&
clearInterval(this.slideShowTimer)},hasImage:function(){return this.imageArray.length>0},hasImages:function(){return this.imageArray.length>1},isFirstImage:function(){return this.activeImage==0},isLastImage:function(){return this.activeImage==this.imageArray.length-1},showNext:function(){if(this.hasImages()){if(!this.options.loop&&this.isLastImage())return this.end();this.isLastImage()?this.showFirst():this.changeImage(this.activeImage+1)}},showPrev:function(){if(this.hasImages()){if(!this.options.loop&&
this.isFirstImage())return this.end();this.activeImage==0?this.showLast():this.changeImage(this.activeImage-1)}},showFirst:function(){this.hasImages()&&this.changeImage(0)},showLast:function(){this.hasImages()&&this.changeImage(this.imageArray.length-1)},enableKeyboardNav:function(){document.onkeydown=this.keyboardAction},disableKeyboardNav:function(){document.onkeydown=""},keyboardAction:function(a){keycode=a==null?event.keyCode:a.which;key=String.fromCharCode(keycode).toLowerCase();if(key=="x"||
key=="o"||key=="c")this.end();else if(key=="p"||key=="%")this.showPrev();else if(key=="n"||key=="'")this.showNext();else if(key=="f")this.showFirst();else if(key=="l")this.showLast();else key=="s"&&this.hasImage()&&this.options.enableSlideshow&&this.toggleSlideShow()},preloadNeighborImages:function(){var a=this.imageArray.length-1==this.activeImage?0:this.activeImage+1;nextImage=new Image;nextImage.src=this.imageArray[a].link;a=this.activeImage==0?this.imageArray.length-1:this.activeImage-1;prevImage=
new Image;prevImage.src=this.imageArray[a].link},end:function(){this.disableKeyboardNav();this.pauseSlideShow();this.getEl("lightbox").hide();this.getEl("overlay").fadeOut(this.overlayDuration);this.showBadObjects()},showBadObjects:function(a){c(this.badObjects.join(",")).css("visibility",(typeof a=="undefined"?true:!!a)?"visible":"hidden")},hideBadObjects:function(){this.showBadObjects(false)},pause:function(a){var b=new Date;for(a=b.getTime()+a;;){b=new Date;if(b.getTime()>a)return}},getPageScroll:function(){var a,
b;if(self.pageYOffset){a=self.pageXOffset;b=self.pageYOffset}else if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollLeft;b=document.documentElement.scrollTop}else if(document.body){a=document.body.scrollLeft;b=document.body.scrollTop}return{x:a,y:b}},getPageSize:function(){var a,b,d,e;if(window.innerHeight&&window.scrollMaxY){a=document.body.scrollWidth;b=window.innerHeight+window.scrollMaxY}else if(document.body.scrollHeight>document.body.offsetHeight){a=
document.body.scrollWidth;b=document.body.scrollHeight}else{a=document.body.offsetWidth;b=document.body.offsetHeight}if(self.innerHeight){d=self.innerWidth;e=self.innerHeight}else if(document.documentElement&&document.documentElement.clientHeight){d=document.documentElement.clientWidth;e=document.documentElement.clientHeight}else if(document.body){d=document.body.clientWidth;e=document.body.clientHeight}return{pageWidth:a<d?d:a,pageHeight:b<e?e:b,winWidth:d,winHeight:e}},getID:function(a){return this.options.prefix+
a},getSel:function(a){return"#"+this.getID(a)},getEl:function(a){return c(this.getSel(a))}}})(jQuery);
